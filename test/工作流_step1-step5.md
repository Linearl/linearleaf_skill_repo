# 投研工作流（Step1–Step5，一次性执行）

> 目的：用结构化工作流一次性完成 Step1-3，减少交互次数；并确保可复现、可归档、可快速复跑。

参考基准：

- [投资prompt/invest.md](../invest.md)
- [投资prompt/test](.)
- [投资prompt/test/20260119](20260119)
- 参考风格：Linearl/copilot_workflows（结构化流程、检查点、产出清单）

---

## 0. 运行总览（一次性输入）

**输入参数（一次性确认）**

- 研究时间窗：例如 2026年1–3月
- 研究范围：A股；是否包含港股/中概股（默认否）
- 目标赛道数量：3–5 个（默认 5）
- 赛道候选库：允许 AI 自行拓展（默认是）
- 产出目录：
  - 本次运行目录：`投资prompt/test/YYYYMMDD/`
  - 若需同步为“当前版”，再拷贝到：`投资prompt/test/1/`

**一次性执行目标**

1) Step1：赛道筛选文档
2) Step2：产业链挖掘文档（按赛道逐篇）
3) Step3：逐股“去伪”文档（财报下载与摘录）+阶段性汇总表
4) Step4：逐股消息与新闻检索（催化/风险）
5) Step5：技术面走势分析与介入策略（最终汇总表）

**默认目录规范（必须遵守）**

```
投资prompt/test/YYYYMMDD/
  step1/
  step2/
  step3/
    tools/
    financials/
    analysis/
    report/
  step4/
    tools/
    analysis/
    report/
  step5/
    tools/
    report/
```

---

## 1. Step1：赛道筛选（找风口）

**输入**

- 时间窗、会议/政策/季节性事件

**执行规则**

- 输出 3–5 个可能爆发赛道
- 每个赛道给出：核心催化、代表龙头股

**产出**

- 文件名：`01_赛道筛选_YYYYQx_A股潜在爆发行情.md`
- 目录：`step1/`

**检查点**

- 是否明确“催化来源”？
- 是否给出代表龙头股？
- 是否解释选择排序？

---

## 2. Step2：产业链挖掘（找铲子）

**输入**

- Step1 的赛道列表

**执行规则**

- 每个赛道单独一篇
- 拆解产业链：关键环节、价值量最高处、铲子股

**产出**

- 文件名：`02A~02E_产业链挖掘_{赛道}_YYYYQx.md`
- 目录：`step2/`
- 额外文件：`step2/02_标的清单.yaml`（字段：name、track、code）

**检查点**

- 是否包含“关键环节/价值量/铲子股”？
- 是否给出 A 股龙头与备选？

---

## 3. Step3：深度去伪（财报验证）

**输入**

- Step2 的候选股清单
- 财报下载工具与目录

**执行规则**

- 每只股票生成一篇分析报告
- 必须下载年报/季报，抽取“分产品/客户/订单/风险”关键词
- 必须给出地缘风险清单
- Step3 结束后生成“阶段性汇总表”（仅基于财报）
- Step3 的 E 部分必须给出结论（业务真实性、证据摘要、最大风险）
- Step3 使用 step2 的标的清单 YAML 作为输入（禁止硬编码）
- Step3 的结论说明（E 段）需要手动研读财报后补写，禁止仅依赖自动生成内容
- Step3 拆分为两阶段：下载（脚本A）+分析（脚本B）

**人工精读要求（新增）**
- 必须逐只精读年报/季报中的“分产品/分行业/收入毛利/风险因素”段落
- 结论说明用自然化语言写明“业务落地证据点 + 风险集中点 + 缺口（如客户/订单披露不足）”
- 不得引用原文长段落，不得仅给出模板化表述

**阶段性汇总（Step3）**

- 汇总字段：业务真实性、主要风险、财报证据要点

**工具与目录**

- 下载脚本：`step3/tools/step3_download_reports.py`
- 分析脚本：`step3/tools/step3_cninfo_reports_and_notes.py`
- 配置：`step2/02_标的清单.yaml`
- 财报：`step3/financials/{代码_名称}/`
- 报告：`step3/analysis/03_{赛道}_{代码}_{名称}.md`
- 阶段性汇总：`step3/report/03_汇总_结论表.md`

**执行建议（一次性跑完）**

- 全量执行：逐只股票下载财报、抽取关键词、生成报告
- 若需验证流程，可先跑 1 只股票，确认闭环后再全量

**检查点**

- 财报是否已保存到 `financials/`？
- 抽取文本是否生成 `annual_extract.txt` 与 `quarterly_extract.txt`？
- 报告是否包含：去伪证据、地缘风险表？
- 是否生成 Step3 阶段性汇总表？

---

## 4. 一次性执行请求模板（减少交互）

> 直接复制下面文字给 AI，作为一次性请求。

**模板**

请按照“投资prompt/test/工作流_step1-step5.md”执行一次性工作流，完成 Step1–Step5。

参数：

- 时间窗：[YYYY年M–M月]
- 研究范围：[A股]
- 赛道数量：[3-5]
- 输出目录：[投资prompt/test/YYYYMMDD]
- 若完成后需要同步到当前版目录：[是/否；如是复制到投资prompt/test/1]

执行要求：

1) Step1 输出赛道筛选文档到 step1/
2) Step2 输出 5 篇产业链挖掘文档到 step2/
3) Step3 使用 step3/tools/step3_cninfo_reports_and_notes.py 自动下载财报并生成逐股分析报告到 step3/analysis/
4) Step3 结束后生成阶段性汇总表到 step3/report/03_汇总_结论表.md
5) Step4 生成新闻与事件文档到 step4/analysis/
6) Step5 生成最终介入策略表到 step5/report/05_汇总_介入策略表.md
7) 全程记录异常，若失败请写入对应 steps 的 tools/ 目录

---

## 4. Step4：消息与新闻检索（催化/风险）

**输入**

- Step2 的候选股清单

**执行规则**

- 搜索近 30–60 天的公告/新闻/事件
- 提取：正向催化、负向风险、时间窗口

**产出**

- 文件名：`04_新闻与事件_{赛道}_{代码}_{名称}.md`
- 目录：`step4/analysis/`

**汇总输出**

- 文件名：`04_汇总_新闻表.md`
- 目录：`step4/report/`

**工具与目录**

- 脚本：`step4/tools/step4_news.py`
- 汇总脚本：`step4/tools/step4_news_summary.py`

**检查点**

- 是否包含时间戳与来源？
- 是否区分催化与风险？
- 是否生成 Step4 汇总新闻表？

---

## 5. Step5：技术面走势与介入策略（最终汇总）

**输入**

- Step3 阶段性汇总表
- Step4 新闻与事件摘要

**执行规则**

- 获取近 120 个交易日的日线数据
- 计算 MA20/MA60/MA250、20/60/250 日高低点
- 输出：走势判断、入场策略、预期价格区间（参考）、支撑/压力
- 复制 Step3 汇总表并更新，形成最终介入策略表

**产出**

- 文件名：`05_汇总_介入策略表.md`
- 目录：`step5/report/`

**检查点**

- 是否补全技术面字段？
- 是否与新闻事件的时间窗口冲突？

---

## 5. 异常处理与复跑策略

**常见异常**

- 财报接口不可用：延迟重试或更换数据源
- PDF 解析失败：记录失败并继续下一个

**复跑策略**

- 已下载文件不重复下载
- 只跑指定股票：在脚本参数中传入 `代码,代码`

---

## 6. 归档与版本策略

- 每次完整运行使用 `投资prompt/test/YYYYMMDD/` 作为快照
- 如需更新“当前版”，再同步到 `投资prompt/test/1/`
- 关键结论可在后续追加“最终摘要/一页纸”

---

## 7. 合规提醒

> 以上内容仅供研究，不构成投资建议。市场有风险，入市需谨慎。
